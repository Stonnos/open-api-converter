{"openapi":"3.0.1","info":{"title":"Evaluation external API microservice","description":"API provides operations to performs classifiers evaluation requests","contact":{"name":"Roman Batygin","email":"roman.batygin@mail.ru"},"version":"6.1"},"servers":[{"url":"/"}],"paths":{"/uploads-train-data":{"post":{"tags":["Operations for external API"],"summary":"Uploads train data file","description":"Uploads train data file","operationId":"uploadInstances","requestBody":{"content":{"multipart/form-data":{"schema":{"required":["trainingData"],"type":"object","properties":{"trainingData":{"type":"string","description":"Training data file","format":"binary"}}}}}},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InstancesResponseDto"},"example":{"payload":{"dataId":"2a35bffe-27ad-4a50-a7e0-8c871cfd7cc5","dataUrl":"data://2a35bffe-27ad-4a50-a7e0-8c871cfd7cc5"},"responseCode":"SUCCESS","errorDescription":null}}}},"401":{"description":"Not authorized","content":{"application/json":{"example":{"error":"unauthorized","error_description":"Full authentication is required to access this resource"}}}},"400":{"description":"Bad request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResponseDto"},"example":{"payload":[{"fieldName":"trainingData","code":"ValidTrainData","errorMessage":"Invalid train data extension. Must be one of xls, xlsx, csv, arff, json, xml, txt, data, docx"}],"responseCode":"VALIDATION_ERROR","errorDescription":"Validation errors"}}}}},"security":[{"EcaAuth":["external-api"]}]}},"/evaluation-request":{"post":{"tags":["Operations for external API"],"summary":"Processes evaluation request","description":"Processes evaluation request","operationId":"evaluateModel","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/EvaluationRequestDto"},"example":{"trainDataUrl":"http://kt.ijs.si/Branax/Repository/WEKA/Iris.xls","classifierOptions":{"type":"logistic","maxIts":200,"useConjugateGradientDescent":false},"evaluationMethod":"CROSS_VALIDATION","numFolds":10,"numTests":1,"seed":1}}},"required":true},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EvaluationResponsePayloadDto"},"example":{"payload":{"requestId":"1cbe6c49-8432-4c81-9afa-90f04a803fed","evaluationStatus":"IN_PROGRESS","modelUrl":null,"numTestInstances":null,"numCorrect":null,"numIncorrect":null,"pctCorrect":null,"pctIncorrect":null,"meanAbsoluteError":null},"responseCode":"SUCCESS","errorDescription":null}}}},"401":{"description":"Not authorized","content":{"application/json":{"example":{"error":"unauthorized","error_description":"Full authentication is required to access this resource"}}}},"400":{"description":"Bad request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResponseDto"},"example":{"payload":[{"fieldName":"classifierOptions","code":"NotNull","errorMessage":"must not be null"},{"fieldName":"evaluationMethod","code":"NotNull","errorMessage":"must not be null"}],"responseCode":"VALIDATION_ERROR","errorDescription":"Validation errors"}}}}},"security":[{"EcaAuth":["external-api"]}]}},"/evaluation-status/{requestId}":{"get":{"tags":["Operations for external API"],"summary":"Gets evaluation response status","description":"Gets evaluation response status","operationId":"getEvaluationResponseStatus","parameters":[{"name":"requestId","in":"path","description":"Request id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EvaluationResponsePayloadDto"},"example":{"payload":{"requestId":"1cbe6c49-8432-4c81-9afa-90f04a803fed","evaluationStatus":"FINISHED","modelUrl":"http://localhost:8080/external-api/download-model/1cbe6c49-8432-4c81-9afa-90f04a803fed","numTestInstances":150,"numCorrect":144,"numIncorrect":6,"pctCorrect":96,"pctIncorrect":4,"meanAbsoluteError":0.02869334024628254},"responseCode":"SUCCESS","errorDescription":null}}}},"401":{"description":"Not authorized","content":{"application/json":{"example":{"error":"unauthorized","error_description":"Full authentication is required to access this resource"}}}},"400":{"description":"Bad request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResponseDto"},"example":{"payload":[{"fieldName":null,"code":"DataNotFound","errorMessage":"Entity with search key [1] not found!"}],"responseCode":"VALIDATION_ERROR","errorDescription":"Validation errors"}}}}},"security":[{"EcaAuth":["external-api"]}]}},"/download-model/{requestId}":{"get":{"tags":["Operations for external API"],"summary":"Downloads classifier model","description":"Downloads classifier model","operationId":"downloadModel","parameters":[{"name":"requestId","in":"path","description":"Request id","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"string","format":"binary"}}}},"401":{"description":"Not authorized","content":{"application/json":{"example":{"error":"unauthorized","error_description":"Full authentication is required to access this resource"}}}},"400":{"description":"Bad request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResponseDto"},"example":{"payload":[{"fieldName":null,"code":"DataNotFound","errorMessage":"Entity with search key [1] not found!"}],"responseCode":"VALIDATION_ERROR","errorDescription":"Validation errors"}}}}},"security":[{"EcaAuth":["external-api"]}]}}},"components":{"schemas":{"InstancesDto":{"type":"object","properties":{"dataId":{"type":"string","description":"Data id","example":"2a35bffe-27ad-4a50-a7e0-8c871cfd7cc5"},"dataUrl":{"type":"string","description":"Train data url in internal format data://dataId","example":"data://2a35bffe-27ad-4a50-a7e0-8c871cfd7cc5"}},"description":"Instances model"},"InstancesResponseDto":{"type":"object","properties":{"payload":{"$ref":"#/components/schemas/InstancesDto"},"responseCode":{"type":"string","description":"Response code","example":"SUCCESS","enum":["SUCCESS","VALIDATION_ERROR","DATA_NOT_FOUND","ERROR","TIMEOUT","SERVICE_UNAVAILABLE"]},"errorDescription":{"type":"string","description":"Error message"}},"description":"Instances response wrapper model"},"ResponseDto":{"type":"object","properties":{"payload":{"type":"object","description":"Response payload"},"responseCode":{"type":"string","description":"Response code","example":"SUCCESS","enum":["SUCCESS","VALIDATION_ERROR","DATA_NOT_FOUND","ERROR","TIMEOUT","SERVICE_UNAVAILABLE"]},"errorDescription":{"type":"string","description":"Error message"}},"description":"Response model"},"EvaluationResponseDto":{"type":"object","properties":{"requestId":{"type":"string","description":"Evaluation request id","example":"1cbe6c49-8432-4c81-9afa-90f04a803fed"},"evaluationStatus":{"type":"string","description":"Evaluation status","example":"FINISHED","enum":["IN_PROGRESS","FINISHED","TIMEOUT","ERROR"]},"modelUrl":{"type":"string","description":"Model url","example":"http://localhost:8080/external-api/download-model/1cbe6c49-8432-4c81-9afa-90f04a803fed"},"numTestInstances":{"type":"integer","description":"Test instances number","format":"int32","example":150},"numCorrect":{"type":"integer","description":"Correctly classified instances number","format":"int32","example":144},"numIncorrect":{"type":"integer","description":"Incorrectly classified instances number","format":"int32","example":6},"pctCorrect":{"type":"number","description":"Correctly classified percentage","example":96},"pctIncorrect":{"type":"number","description":"Incorrectly classified percentage","example":4},"meanAbsoluteError":{"type":"number","description":"Mean absolute error","example":0.029}},"description":"Evaluation response model"},"EvaluationResponsePayloadDto":{"type":"object","properties":{"payload":{"$ref":"#/components/schemas/EvaluationResponseDto"},"responseCode":{"type":"string","description":"Response code","example":"SUCCESS","enum":["SUCCESS","VALIDATION_ERROR","DATA_NOT_FOUND","ERROR","TIMEOUT","SERVICE_UNAVAILABLE"]},"errorDescription":{"type":"string","description":"Error message"}},"description":"Evaluation response payload model"},"ActivationFunctionOptions":{"type":"object","properties":{"activationFunctionType":{"type":"string","description":"Activation function type","enum":["LOGISTIC","HYPERBOLIC_TANGENT","SINUSOID","EXPONENTIAL","SOFT_SIGN","INVERSE_SQUARE_ROOT_UNIT"]},"coefficient":{"type":"number","description":"Activation function coefficient value","format":"double"}},"description":"Activation function options"},"AdaBoostOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"numIterations":{"type":"integer","description":"Iterations number","format":"int32"},"numThreads":{"type":"integer","description":"Threads number","format":"int32"},"seed":{"type":"integer","description":"Seed value for random generator","format":"int32"},"minError":{"type":"number","description":"Classifier min. error threshold","format":"double"},"maxError":{"type":"number","description":"Classifier max. error threshold","format":"double"},"classifierOptions":{"type":"array","items":{"$ref":"#/components/schemas/ClassifierOptions"}}}}]},"BackPropagationOptions":{"type":"object","properties":{"learningRate":{"type":"number","description":"Learning rate value","format":"double"},"momentum":{"type":"number","description":"Momentum coefficient value","format":"double"}},"description":"Back propagation options"},"ClassifierOptions":{"required":["type"],"type":"object","properties":{"type":{"type":"string"}},"description":"Classifier options json","discriminator":{"propertyName":"type"}},"DecisionTreeOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"decisionTreeType":{"type":"string","description":"Decision tree algorithm","enum":["CART","ID3","C45","CHAID"]},"minObj":{"type":"integer","description":"Minimum objects number per leaf","format":"int32"},"maxDepth":{"type":"integer","description":"Maximum tree depth","format":"int32"},"randomTree":{"type":"boolean","description":"Random tree flag"},"numRandomAttr":{"type":"integer","description":"Random attributes number at each split for random tree","format":"int32"},"useBinarySplits":{"type":"boolean","description":"Binary tree flag"},"useRandomSplits":{"type":"boolean","description":"Use random splits flag"},"numRandomSplits":{"type":"integer","description":"Random splits number at each node split","format":"int32"},"seed":{"type":"integer","description":"Seed value for random generator","format":"int32"},"additionalOptions":{"type":"object","additionalProperties":{"type":"string","description":"Additional options map"},"description":"Additional options map"}}}]},"EvaluationRequestDto":{"required":["classifierOptions","evaluationMethod","trainDataUrl"],"type":"object","properties":{"trainDataUrl":{"type":"string","description":"Train data url","example":"http://kt.ijs.si/Branax/Repository/WEKA/Iris.xls"},"classifierOptions":{"oneOf":[{"$ref":"#/components/schemas/AdaBoostOptions"},{"$ref":"#/components/schemas/DecisionTreeOptions"},{"$ref":"#/components/schemas/ExtraTreesOptions"},{"$ref":"#/components/schemas/HeterogeneousClassifierOptions"},{"$ref":"#/components/schemas/J48Options"},{"$ref":"#/components/schemas/KNearestNeighboursOptions"},{"$ref":"#/components/schemas/LogisticOptions"},{"$ref":"#/components/schemas/NeuralNetworkOptions"},{"$ref":"#/components/schemas/RandomForestsOptions"},{"$ref":"#/components/schemas/RandomNetworkOptions"},{"$ref":"#/components/schemas/StackingOptions"}]},"evaluationMethod":{"type":"string","description":"Evaluation method","enum":["TRAINING_DATA","CROSS_VALIDATION"]},"numFolds":{"maximum":10,"minimum":2,"type":"integer","description":"Folds number for k * V cross - validation method","format":"int32","example":10},"numTests":{"maximum":10,"minimum":1,"type":"integer","description":"Tests number for k * V cross - validation method","format":"int32","example":1},"seed":{"type":"integer","description":"Seed value for k * V cross - validation method","format":"int32","example":1}},"description":"Evaluation request model"},"ExtraTreesOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"numIterations":{"type":"integer","description":"Iterations number","format":"int32"},"numThreads":{"type":"integer","description":"Threads number","format":"int32"},"seed":{"type":"integer","description":"Seed value for random generator","format":"int32"},"numRandomAttr":{"type":"integer","description":"Random attributes number at each node split","format":"int32"},"minObj":{"type":"integer","description":"Min. objects per leaf","format":"int32"},"maxDepth":{"type":"integer","description":"Maximum tree depth","format":"int32"},"decisionTreeType":{"type":"string","description":"Decision tree algorithm","enum":["CART","ID3","C45","CHAID"]},"numRandomSplits":{"type":"integer","description":"Number of random splits","format":"int32"},"useBootstrapSamples":{"type":"boolean","description":"Use bootstrap samples flag"}}}]},"HeterogeneousClassifierOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"numIterations":{"type":"integer","description":"Iterations number","format":"int32"},"numThreads":{"type":"integer","description":"Threads number","format":"int32"},"seed":{"type":"integer","description":"Seed value for random generator","format":"int32"},"minError":{"type":"number","description":"Classifier min. error threshold","format":"double"},"maxError":{"type":"number","description":"Classifier max. error threshold","format":"double"},"classifierOptions":{"type":"array","items":{"$ref":"#/components/schemas/ClassifierOptions"}},"useWeightedVotes":{"type":"boolean","description":"Use weighted votes method"},"useRandomClassifier":{"type":"boolean","description":"Use random classifier at each iteration"},"samplingMethod":{"type":"string","description":"Sampling method at each iteration","enum":["INITIAL","BAGGING","RANDOM","RANDOM_BAGGING"]},"useRandomSubspaces":{"type":"boolean","description":"Use random subspaces"}}}]},"J48Options":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"minNumObj":{"type":"integer","description":"Minimum objects number per leaf","format":"int32"},"binarySplits":{"type":"boolean","description":"Binary tree flag"},"unpruned":{"type":"boolean","description":"Unpruned tree flag"},"numFolds":{"type":"integer","description":"Folds number for tree pruning procedure","format":"int32"}}}]},"KNearestNeighboursOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"numNeighbours":{"type":"integer","description":"Neighbours number","format":"int32"},"weight":{"type":"number","description":"Neighbour's weight value","format":"double"},"distanceType":{"type":"string","description":"Distance function type","enum":["EUCLID","SQUARE_EUCLID","MANHATTAN","CHEBYSHEV"]}}}]},"LogisticOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"maxIts":{"type":"integer","description":"Maximum iterations number for optimization method","format":"int32"},"useConjugateGradientDescent":{"type":"boolean","description":"Use conjugate gradient descent method"}}}]},"NeuralNetworkOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"numInNeurons":{"type":"integer","description":"Neurons number in input layer","format":"int32"},"numOutNeurons":{"type":"integer","description":"Neurons number in output layer","format":"int32"},"hiddenLayer":{"type":"string","description":"Hidden layer structure"},"seed":{"type":"integer","description":"Seed value for random generator","format":"int32"},"numIterations":{"type":"integer","description":"Max. its for learning","format":"int32"},"minError":{"type":"number","description":"Min. error for optimization algorithm","format":"double"},"activationFunctionOptions":{"$ref":"#/components/schemas/ActivationFunctionOptions"},"backPropagationOptions":{"$ref":"#/components/schemas/BackPropagationOptions"}}}]},"RandomForestsOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"numIterations":{"type":"integer","description":"Iterations number","format":"int32"},"numThreads":{"type":"integer","description":"Threads number","format":"int32"},"seed":{"type":"integer","description":"Seed value for random generator","format":"int32"},"numRandomAttr":{"type":"integer","description":"Random attributes number at each node split","format":"int32"},"minObj":{"type":"integer","description":"Min. objects per leaf","format":"int32"},"maxDepth":{"type":"integer","description":"Maximum tree depth","format":"int32"},"decisionTreeType":{"type":"string","description":"Decision tree algorithm","enum":["CART","ID3","C45","CHAID"]}}}]},"RandomNetworkOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"numIterations":{"type":"integer","description":"Iterations number","format":"int32"},"numThreads":{"type":"integer","description":"Threads number","format":"int32"},"seed":{"type":"integer","description":"Seed value for random generator","format":"int32"},"minError":{"type":"number","description":"Classifier min. error threshold","format":"double"},"maxError":{"type":"number","description":"Classifier max. error threshold","format":"double"},"useBootstrapSamples":{"type":"boolean","description":"Use bootstrap samples"}}}]},"StackingOptions":{"type":"object","allOf":[{"$ref":"#/components/schemas/ClassifierOptions"},{"type":"object","properties":{"useCrossValidation":{"type":"boolean","description":"Use cross - validation method for meta data building"},"numFolds":{"type":"integer","description":"Folds number for V - cross validation method","format":"int32"},"seed":{"type":"integer","description":"Seed value for random generator","format":"int32"},"classifierOptions":{"type":"array","items":{"$ref":"#/components/schemas/ClassifierOptions"}},"metaClassifierOptions":{"$ref":"#/components/schemas/ClassifierOptions"}}}]}},"securitySchemes":{"EcaAuth":{"type":"oauth2","description":"Oauth2 authentication","name":"EcaAuth","in":"header","bearerFormat":"Authorization: Bearer <access token>","flows":{"clientCredentials":{"tokenUrl":"http://localhost:8080/oauth/token","scopes":{"external-api":""}}}}}}}